machine:
  environment:
    # Use a longer timeout to prevent timeout errors
    # See https://code.google.com/p/android/issues/detail?id=189764
    ADB_INSTALL_TIMEOUT: 6000
    
    # Limit memory usage to avoid the 4gb limit on CircleCi
    # See https://circleci.com/docs/oom/#out-of-memory-errors-in-android-builds
    GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx2048m -XX:+HeapDumpOnOutOfMemoryError"'
    
    TERM: "dumb"
    
  java:
    version: oraclejdk8
    
dependencies:
    pre:
        # The files containing API keys are not tracked in git
        # Write them from environment variables
        - echo $google_services_json4 > app/google-services.json
        - echo $ids_xml_4 > app/src/main/res/values/ids.xml
    
        # Since it is only building the debug apk, the key values don't matter
        (echo "storePassword=a" && echo "keyPassword=b" && echo "keyAlias=PTSD" && echo "storeFile=/PTSD/PTSDkey.jks") > app/keystore.properties

    
test:
  override:
    - ./gradlew build:
        timeout: 1800  # Timeout after 30 minutes (Default 10 minutes)